<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMS • GIS Grosseto - Sistema Mercati</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome per icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSS personalizzato -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header principale -->
    <header class="main-header">
        <div class="header-left">
            <img src="marker-icon.png" alt="DMS Logo" class="logo">
            <h1>DMS • GIS Grosseto</h1>
        </div>
        <div class="header-right">
            <button id="btnConfigDMS" class="btn-primary">
                <i class="fas fa-cog"></i> Configura DMS
            </button>
            <button id="btnStats" class="btn-secondary">
                <i class="fas fa-chart-bar"></i> Statistiche
            </button>
        </div>
    </header>

    <!-- Layout principale con sidebar -->
    <div class="main-layout">
        <!-- Sidebar sinistra (stile g3w-suite) -->
        <div class="sidebar-left" id="sidebarLeft">
            <div class="sidebar-header">
                <h3><i class="fas fa-layer-group"></i> Strati</h3>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <!-- Controlli layer -->
            <div class="layer-controls">
                <div class="layer-group">
                    <div class="layer-group-header">
                        <i class="fas fa-folder-open"></i>
                        <span>Mercati_test_v3</span>
                    </div>
                    
                    <div class="layer-group-content">
                        <!-- Layer Mercati -->
                        <div class="layer-item">
                            <div class="layer-checkbox">
                                <input type="checkbox" id="layerMercati" checked>
                                <label for="layerMercati">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Mercati
                                </label>
                            </div>
                        </div>
                        
                        <!-- Layer Posteggi Mercati -->
                        <div class="layer-item">
                            <div class="layer-group-header">
                                <i class="fas fa-folder"></i>
                                <span>Posteggi Mercati</span>
                            </div>
                            <div class="layer-subgroup">
                                <div class="layer-checkbox">
                                    <input type="checkbox" id="layerEsperanto" checked>
                                    <label for="layerEsperanto">
                                        <i class="fas fa-square"></i>
                                        Esperanto Settimanale-Giovedì
                                    </label>
                                </div>
                                <div class="layer-checkbox">
                                    <input type="checkbox" id="layerTripoli" checked>
                                    <label for="layerTripoli">
                                        <i class="fas fa-square"></i>
                                        Tripoli Giornaliero
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabella Posteggi -->
                        <div class="layer-item">
                            <div class="layer-checkbox">
                                <input type="checkbox" id="layerTabella">
                                <label for="layerTabella">
                                    <i class="fas fa-table"></i>
                                    Tabella Posteggi
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ricerche -->
            <div class="search-section">
                <h4><i class="fas fa-search"></i> Ricerche</h4>
                <div class="search-controls">
                    <select id="searchType">
                        <option value="numero">Numero Posteggio</option>
                        <option value="titolare">Titolare</option>
                        <option value="mercato">Mercato</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="Inserisci valore...">
                    <button id="btnSearch" class="btn-search">
                        <i class="fas fa-search"></i> Cerca
                    </button>
                </div>
            </div>
        </div>

        <!-- Area mappa principale -->
        <div class="map-container">
            <!-- Controlli mappa -->
            <div class="map-controls">
                <div class="zoom-controls">
                    <button id="zoomIn" class="zoom-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button id="zoomOut" class="zoom-btn">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
                
                <!-- Search box indirizzi -->
                <div class="address-search">
                    <input type="text" id="addressInput" placeholder="Indirizzo ...">
                    <button id="btnAddressSearch">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mappa -->
            <div id="map"></div>
            
            <!-- Barra coordinate -->
            <div class="coordinate-bar">
                <span id="coordinates">X: 1673000.00, Y: 4736500.00 [EPSG:3003]</span>
                <span id="scale">1:16203</span>
            </div>
        </div>
    </div>

    <!-- Sidebar destra per elenco posteggi -->
    <div class="sidebar-right" id="sidebarRight">
        <div class="sidebar-header">
            <h3><i class="fas fa-list"></i> Elenco Posteggi</h3>
            <button class="close-btn" onclick="toggleRightSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sidebar-stats" id="sidebarStats">
            <!-- Statistiche dinamiche -->
        </div>
        
        <div class="sidebar-filters">
            <input type="text" id="filterInput" placeholder="Filtra per numero o titolare...">
            <select id="statusFilter">
                <option value="">Tutti gli stati</option>
                <option value="Libero">Solo Liberi</option>
                <option value="Occupato">Solo Occupati</option>
            </select>
        </div>
        
        <div class="posteggi-list" id="posteggiList">
            <!-- Lista posteggi dinamica -->
        </div>
    </div>

    <!-- Pulsante per aprire elenco posteggi -->
    <button class="list-toggle" onclick="toggleRightSidebar()">
        <i class="fas fa-list"></i> Elenco
    </button>

    <!-- Legenda -->
    <div class="legend">
        <h4><i class="fas fa-palette"></i> Legenda</h4>
        <div class="legend-items">
            <div class="legend-item">
                <span class="legend-color libero"></span>
                <span>Libero</span>
            </div>
            <div class="legend-item">
                <span class="legend-color occupato"></span>
                <span>Occupato</span>
            </div>
            <div class="legend-item">
                <span class="legend-color riservato"></span>
                <span>Riservato</span>
            </div>
            <div class="legend-item">
                <span class="legend-color temporaneo"></span>
                <span>Temporaneo</span>
            </div>
        </div>
    </div>

    <!-- Dipendenze ordine corretto -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>window.DMS_BUILD='lock6c';</script>
    <script src="./libs/turf.min.js?v=lock6c"></script>
    <script defer src="./app.lock6c.js?v=lock6c"></script>

    <style>
      /* nasconde eventuali controlli duplicati top-right di plugin legacy */
      .leaflet-top.leaflet-right{display:none!important;}
      
      /* CSS per LOCK6c */
      .dms-banner{position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#1f2937;color:#fff;padding:8px 12px;border-radius:8px;z-index:9999;font:600 13px/1.2 system-ui;}
      .hub-label{background:transparent!important;border:none!important;color:#fff!important;text-shadow:0 1px 2px rgba(0,0,0,.5);font-weight:700!important;}
      .hub-dot{z-index:1000;}
    </style>
</body>
</html>

